<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>*character name's Charactersheet</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e67e22;
            --bg: #fdfbf7;
            --panel: #ffffff;
            --border: #dcdcdc;
            --text-main: #333333;
            --text-muted: #666666;
            --bg-secondary: #eeeeee;
            --bg-tertiary: #f0f4f8;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg);
            color: var(--text-main);
            padding-bottom: 50px;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --primary: #aab7c4;
            --bg: #121212;
            --panel: #1e1e1e;
            --border: #333333;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #252525;
        }

        /* Header */
        .sheet-header { text-align: center; border-bottom: 3px double var(--primary); padding-bottom: 15px; margin-bottom: 20px; }
        .header-stats { display: flex; justify-content: center; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .stat-pill { font-size: 0.9rem; background: #eee; padding: 5px 15px; border-radius: 15px; display: inline-block; }

        /* Vitals (HP, AC) */
        .vitals { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .vital-box { border: 2px solid var(--primary); width: 70px; padding: 10px 5px; text-align: center; background: var(--panel); }
        .vital-box h2 { margin: 0; font-size: 1.6rem; color: var(--primary); }
        .vital-box span { font-size: 0.9rem; font-weight: bold; color: #666; }
        .sub-label { font-size: 0.7rem; color: #888; display: block; margin-top: 2px; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 25px; }
        .stat-btn { background: var(--panel); border: 1px solid var(--primary); border-radius: 8px; padding: 10px; cursor: pointer; text-align: center; transition: all 0.2s; }
        .stat-btn:hover { background: var(--primary); color: white; transform: translateY(-2px); }
        .mod { font-size: 1.4rem; font-weight: bold; display: block; }
        .label { font-size: 0.8rem; font-weight: bold; letter-spacing: 1px; }

        /* Skill Table */
        .skill-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.95rem; }
        .skill-row { border-bottom: 1px solid #eee; }
        .skill-cell { padding: 8px 5px; }
        .skill-marker { width: 20px; text-align: center; color: #ccc; font-size: 1.2rem; }
        .is-proficient { color: var(--accent); } 
        .is-expert { color: var(--accent); text-shadow: 0 0 1px var(--accent); }
        .skill-name { text-align: left; font-weight: 500; }
        .skill-val { text-align: right; font-weight: bold; color: var(--primary); }
        .save-row { background-color: #f0f4f8; font-weight: bold; }
        .save-row .skill-name { color: var(--primary); }

        /* Inventory & Lists */
        h3 { border-bottom: 1px solid var(--border); color: var(--primary); margin-top: 30px; padding-bottom: 5px; }
        details { background: var(--panel); border: 1px solid var(--border); margin-bottom: 8px; border-radius: 4px; }
        summary { padding: 12px; cursor: pointer; font-weight: 600; display: flex; align-items: center; list-style: none; }
        summary > span:first-child { margin-right: auto; }
        summary::-webkit-details-marker { display: none; }
        summary::after { content: "+"; font-size: 1.2rem; color: var(--accent); margin-left: 10px; }
        details[open] summary::after { content: "‚àí"; }
        .content { padding: 15px; border-top: 1px solid #eee; font-size: 0.95rem; line-height: 1.5; }
        
        /* Badges */
        .badge { font-size: 0.75rem; padding: 2px 8px; border-radius: 12px; background: #e0e0e0; color: #555; text-transform: uppercase; font-weight: bold; margin: 0 10px; }
        .type-potion { background: #ffeaa7; color: #d35400; }
        .type-weapon { background: #ff7675; color: #fff; }
        .type-armor { background: #74b9ff; color: #fff; }
        .type-gear { background: #bdc3c7; color: #2c3e50; }
        .type-feature { background: #16a085; color: #fff; }
        .type-magic { background: #f1c40f; color: #fff; }
        .type-ki { background: #8e44ad; color: #fff; }


        /* Notes */
        .notes-container { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 15px; }
        .note-block { margin-bottom: 15px; border-bottom: 1px dashed #eee; padding-bottom: 10px; }
        .note-block:last-child { border: none; margin: 0; padding: 0; }
        .note-title { font-size: 0.9rem; text-transform: uppercase; color: var(--accent); font-weight: bold; display: block; margin-bottom: 5px; }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 25px; border-radius: 8px; max-width: 340px; width: 90%; position: relative; max-height: 80vh; overflow-y: auto; }
        .close-btn { position: absolute; top: 10px; right: 10px; background: #eee; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-weight: bold; }
        .modal-title { color: var(--accent); border-bottom: 1px solid #eee; margin-top: 0; padding-bottom: 10px; }
    
        /* Spell Styles */
        .type-spell { background: #9b59b6; color: white; } 
        .type-cantrip { background: #95a5a6; color: white; }

        .spell-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 0.85rem;
            color: #555;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent);
        }
        .meta-item { display: flex; flex-direction: column; }
        .meta-label { font-size: 0.7rem; font-weight: bold; text-transform: uppercase; color: #999; }
        .meta-val { font-weight: 600; color: var(--primary); }

        /* Spell Slots */
        .slots-wrapper {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .slot-group {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f0f4f8;
            padding: 5px 12px;
            border-radius: 8px;
            border: 1px solid #dce4ec;
        }
        .slot-label { font-weight: bold; color: #555; font-size: 0.9rem; }
        .slot-val { font-weight: bold; color: var(--accent); font-size: 1.1rem; }
        
        /* ================= SPELLS ================= */
        .spell-guide-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 25px;
            justify-content: space-around;
            background: #f0f4f8;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dce4ec;
        }
        .guide-box {
            flex: 1;
            min-width: 240px;
            text-align: center;
        }
        .guide-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 10px;
            display: block;
        }
        .formula-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
            font-family: 'Segoe UI', sans-serif;
        }
        .math-sign {
            font-size: 1.5rem;
            color: #7f8c8d;
            font-weight: 300;
        }
        /* Shapes */
        .guide-shape {
            width: 45px; height: 45px;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; color: var(--primary);
            font-size: 1rem;
            background: white;
            border: 2px solid #bdc3c7;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .shape-static {
            font-size: 1.8rem; border: none; background: none; box-shadow: none; width: auto;
        }
        .shape-d20 {
            border-radius: 4px; background: #eef2f7; border-color: var(--primary);
        }
        .shape-circle {
            border-radius: 50%;
        }
        .shape-diamond {
            transform: rotate(45deg);
            margin: 5px;
        }
        .shape-diamond span {
            transform: rotate(-45deg);
            display: block;
            font-size: 1rem;
            line-height: 1;
        }
        .guide-label {
            font-size: 0.75rem; color: #666; margin-top: 5px; line-height: 1.3;
        }
        .guide-label strong { color: var(--accent); }


        /* ================= DARK MODE ================= */
        body.dark-mode .stat-pill, 
        body.dark-mode .close-btn,
        body.dark-mode .shape-d20 { background: var(--bg-secondary); color: var(--text-main); }

        body.dark-mode .vital-box span { color: var(--text-muted); }
        body.dark-mode .sub-label, 
        body.dark-mode .math-sign,
        body.dark-mode .guide-label { color: var(--text-muted); }
        body.dark-mode .modal-content { background-color: var(--panel); color: var(--text-main); }  /* <--- ADD THIS LINE */

        body.dark-mode .save-row { background-color: #2c3e50; color: #fff; }
        body.dark-mode .save-row .skill-name { color: #fff; }

        body.dark-mode .spell-meta, 
        body.dark-mode .slot-group,
        body.dark-mode .spell-guide-container { background: var(--bg-tertiary); border-color: var(--border); }

        body.dark-mode .guide-shape { background: var(--panel); color: var(--text-main); border-color: #444; }
        body.dark-mode .skill-row { border-bottom-color: #333; }
        body.dark-mode .note-block { border-bottom-color: #333; }
        body.dark-mode details { border-color: #333; }

        /* Toggle Button Style */
        .theme-switch {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: var(--panel);
            border: 1px solid var(--primary);
            color: var(--text-main);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
            z-index: 2000;
            -webkit-tap-highlight-color: transparent;
        }
        
        body.dark-mode .slot-label,
        body.dark-mode .spell-meta { color: var(--text-main); }
        body.dark-mode .shape-static { background: transparent; border: none; box-shadow: none; }

        /* ================= DESKTOP LAYOUT  ================= */
        @media (min-width: 900px) {
            body { max-width: 1200px; padding: 30px; }

            .layout-container {
                display: grid;
                grid-template-columns: 340px 1fr; 
                gap: 40px;
                align-items: start; 
            }
        
            .sidebar-pane {
                position: sticky; 
                top: 20px;

                background: var(--panel);
                border: 2px solid var(--primary);
                border-radius: 16px;
                padding: 25px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.08);

                max-height: calc(100vh - 40px);
                overflow-y: auto; 
                z-index: 10;
            }
        
            .sheet-header { border-bottom: 2px solid #eee; margin-bottom: 20px; padding-bottom: 20px; }
            .vitals { margin-bottom: 25px; }
            .stats-grid { grid-template-columns: 1fr 1fr; gap: 12px; }

            body.dark-mode .sidebar-pane { border-color: #444; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    }
    </style>
</head>

<body>
<button class="theme-switch" onclick="toggleTheme()" id="theme-btn">üåô</button>
<div class="layout-container">
    <div class="sidebar-pane">
        <div class="sheet-header">
            <h1 id="c-name"></h1>
            <p id="c-class" style="margin: 0 0 10px 0; font-weight: 500;"></p>
            
            <div class="header-stats">
                <div class="stat-pill">Initiative: <strong id="c-init"></strong></div>
                <div class="stat-pill">Proficiency: <strong id="c-prof"></strong></div>
                <div class="stat-pill">Passive Perception: <strong id="c-pp"></strong></div>
            </div>
        </div>

        <div class="vitals">
            <div class="vital-box" style="border-radius: 10px 10px 50% 50%;">
                <h2 id="c-hp">--</h2><span>HP</span><span class="sub-label"></span>
            </div>
            <div class="vital-box" style="border-radius: 0 0 50% 50%;">
                <h2 id="c-ac">--</h2><span>AC</span><span class="sub-label"></span>
            </div>
            <div class="vital-box" style="border-radius: 8px;"> 
                <h2 id="c-speed">--</h2><span>Speed</span><span class="sub-label"></span>
            </div>
        </div>

        <div class="stats-grid" id="stats-container"></div>
    </div>

    <div class="content-pane">
        <h3>Attacks & Features</h3>
        <div id="features-container"></div>

        <!-- ADD THIS IF THE USER IS A SPELLCASTER -->
        <!--<div id="spell-section">
            <h3>Spellcasting</h3>
            <div class="spell-guide-container">
            <div class="guide-box">
                <span class="guide-title">Spell Save DC</span>
                <div class="formula-row">
                    <div class="guide-shape shape-static">8</div>
                    <span class="math-sign">+</span>
                    <div class="guide-shape shape-diamond"><span>INT</span></div>
                    <span class="math-sign">+</span>
                    <div class="guide-shape shape-circle">PB</div>
                </div>
                <p class="guide-label">Your enemy has to reach this target number when <u>defending against your spell</u>.<br>(<strong>X</strong> + Ability + Proficiency)</p>
            </div>

            <div class="guide-box" style="border-left: 2px dashed #dce4ec; padding-left: 15px;">
                <span class="guide-title">Spell Attack (To-Hit)</span>
                <div class="formula-row">
                    <div class="guide-shape shape-d20">D20</div>
                    <span class="math-sign">+</span>
                    <div class="guide-shape shape-diamond"><span>INT</span></div>
                    <span class="math-sign">+</span>
                    <div class="guide-shape shape-circle">PB</div>
                </div>
                <p class="guide-label">You need to reach this target number when you want <u>to hit with your spell</u>.<br>(<strong>D20</strong> + Ability + Proficiency)</p>
            </div>
        </div>
            <div class="notes-container" id="slots-container" style="margin-bottom: 15px; text-align:center; display:none;">
                </div>
            <div id="spells-container"></div>
        </div>-->

        <h3>Inventory</h3>
        <div id="inventory-container"></div>

        <h3>Other Notes</h3>
        <div class="notes-container" id="notes-container"></div>

        <div id="modal-overlay" class="modal-overlay" onclick="closeModal()">
            <div class="modal-content" onclick="event.stopPropagation()">
                <button class="close-btn" onclick="closeModal()">X</button>
                <h3 id="m-title" class="modal-title"></h3>
                <div id="m-body"></div>
            </div>
        </div>
    </div>
</div>
<script>
    // =========================================================================
    // 1. CHARACTER STATS - PLACEHOLDER VERSION
    // =========================================================================
    
    const characterSheet = {

        // BASE STATS
        profile: {
            name: "*character name",
            classLevel: "*class | Level X",
            profBonus: "X",
            initiative: "X",
            passivePerception: "X"
        },
        
        // VITALS
        vitals: {
            hp: "X",
            ac: "X",
            speed: "Xft"
        },

        // SKILLS
        // For Proficiency add p:true
        // For Expertise add e:true
        stats: {
            str: { label: "STR", val: "X", title: "Strength", desc: "Measures your physical strength and raw athletic power.", 
                   skills: [ {n:"Save", v:"X"}, {n:"Athletics", v:"X"} ] },
            dex: { label: "DEX", val: "X", title: "Dexterity", desc: "Measures your reflexes and hand-eye coordination.", 
                   skills: [ {n:"Save", v:"X"}, {n:"Acrobatics", v:"X"}, {n:"Stealth", v:"X"}, {n:"Sleight of Hand", v:"X"} ] },
            con: { label: "CON", val: "X", title: "Constitution", desc: "Measures your health, durability and vitality. Mainly used for Max HP calculation.", 
                   skills: [ {n:"Save", v:"X"} ] },
            int: { label: "INT", val: "+X", title: "Intelligence", desc: "Measures your mental sharpness and memory. Originates from learning things.", 
                   skills: [ {n:"Save", v:"+X"}, {n:"Arcana", v:"X"}, {n:"History", v:"X"}, {n:"Investigation", v:"X"}, {n:"Nature", v:"X"}, {n:"Religion", v:"X"} ] },
            wis: { label: "WIS", val: "X", title: "Wisdom", desc: "K√∂rnyezet √©rz√©kel√©se, intu√≠ci√≥. Tapasztalatb√≥l √©s meg√©rz√©sb≈ël ered. Measures your awareness and intuition. Originates from experiene.", 
                   skills: [ {n:"Save", v:"X"}, {n:"Animal Handling", v:"X"}, {n:"Insight", v:"X"}, {n:"Medicine", v:"X"}, {n:"Perception", v:"X"}, {n:"Survival", v:"X"} ] },
            cha: { label: "CHA", val: "X", title: "Charisma", desc: "Szem√©lyis√©g ereje, meggy≈ëz≈ëk√©pess√©g. Measures the strength of your personality and persuasive skills.", 
                   skills: [ {n:"Save", v:"X"}, {n:"Deception", v:"X"}, {n:"Intimidation", v:"X"}, {n:"Performance", v:"X"}, {n:"Persuasion", v:"X"} ] }
        },

        // --- ADD THIS FOR SPELL SLOTS ---
        /* spellSlots: {
            1: "X", 
            2: "X"
        }, */

        // FEATURES
        features: [
            { 
                name: "*weapon name", 
                tag: "Weapon", 
                desc: "*a short description of the weapon<br><br><strong>To Hit: </strong> nds + x<br><strong>Damage:</strong> nds + x *damage type" 
            },
            { 
                name: "*feature name", 
                tag: "Feature", 
                desc: "*description of the feature" 
            },
            // --- ADD THIS FOR KI --- 
            /* { customType: "ki", max: 5 }, 

            { 
                name: "*feature name", 
                tag: "Ki", 
                desc: "*description of the feature" 
            } */
        ],
        
        // ADD THIS FOR SPELLS
        /* spells: [
            { 
                name: "*cantrip name", 
                level: 0, 
                school: "*school",
                time: "1 Action", 
                range: "60 ft", 
                comp: "V, S", 
                dur: "Instant", 
                desc: "*description" 
            },
            { 
                name: "*lvl 1 spell", 
                level: 1, 
                school: "*school",
                time: "1 Action", 
                range: "Touch", 
                comp: "V, S", 
                dur: "Instant", 
                desc: "*description" 
            } 
        ], */

        // INVENTORY
        inventory: [
            { name: "*potion name", type: "Potion", desc: "*description" },
            { name: "*armor name", type: "Armor", desc: "AC X + X" },
            { name: "*gear name", type: "Gear", desc: "*description" },
            { name: "*magic item name", type: "Magic", desc: "*description" }
        ],

        // OTHER NOTES FOR THE PLAYER
        notes: [
            { title: "Languages", text: "*languages" },
            { title: "Tools", text: "*tools" }
        ]
    };

    // =========================================================================
    // 2. THE SYSTEM - DO NOT CHANGE
    // =========================================================================

    function initSheet() {
        try {
            // Header
            if(characterSheet.profile) {
                const p = characterSheet.profile;
                setText('c-name', p.name);
                setText('c-class', p.classLevel);
                setText('c-prof', p.profBonus);
                setText('c-init', p.initiative);
                setText('c-pp', p.passivePerception);
            }

            if(characterSheet.vitals) {
                const v = characterSheet.vitals;
                setText('c-hp', v.hp);
                setText('c-ac', v.ac);
                setText('c-speed', v.speed);
            }

            // Stats
            if(characterSheet.stats) {
                const statContainer = document.getElementById('stats-container');
                statContainer.innerHTML = ''; 
                for (const [key, stat] of Object.entries(characterSheet.stats)) {
                    const div = document.createElement('div');
                    div.className = 'stat-btn';
                    div.onclick = () => openStatModal(key);
                    div.innerHTML = `<span class="label">${stat.label}</span><span class="mod">${stat.val}</span>`;
                    statContainer.appendChild(div);
                }
            }

            // Lists
            renderList('features-container', characterSheet.features || []);
            renderList('inventory-container', characterSheet.inventory || []);
            
            // Spells¬†&¬†Slots
            renderSpells();
            renderSpellSlots(); 

            // Notes
            if(characterSheet.notes) {
                const notesContainer = document.getElementById('notes-container');
                notesContainer.innerHTML = '';
                characterSheet.notes.forEach(note => {
                    const div = document.createElement('div');
                    div.className = 'note-block';
                    div.innerHTML = `<span class="note-title">${note.title}</span><p class="note-text">${note.text}</p>`;
                    notesContainer.appendChild(div);
                });
            }
        } catch (error) {
            console.error("Hiba t√∂rt√©nt:", error);
        }
    }
    function toggleTheme() {
        const body = document.body;
        const btn = document.getElementById('theme-btn');
        body.classList.toggle('dark-mode');

        // Check if dark mode is now on or off
        const isDark = body.classList.contains('dark-mode');
        btn.innerText = isDark ? '‚òÄÔ∏è' : 'üåô'; // Switch icon
    }

    function setText(id, value) {
        const el = document.getElementById(id);
        if(el) el.innerText = value;
    }

    // Slot display
    function renderSpellSlots() {
        const container = document.getElementById('slots-container');
        const slotsData = characterSheet.spellSlots;

        if (!slotsData || Object.keys(slotsData).length === 0) {
            container.style.display = 'none';
            return;
        }
        container.style.display = 'block';

        let html = `
            <span class="note-title" style="color:#e67e22; margin-bottom:2px;">DAILY SPELL SLOTS</span>
            <p style="font-size: 0.8rem; color: #7f8c8d; margin: 0 0 10px 0; font-style: italic;">
                You can use this many Spells of each level after a Long Rest<br>Cantrips can be used any amount of times.<br>
            </p>
            <div class="slots-wrapper">`;

        for (const [level, count] of Object.entries(slotsData)) {
            html += `<div class="slot-group"><span class="slot-label">Lvl ${level}:</span> <span class="slot-val">${count}</span></div>`;
        }
        html += `</div>`;
        container.innerHTML = html;
    }

    function renderList(containerId, dataArray) {
        const container = document.getElementById(containerId);
        container.innerHTML = ''; 
        if(!dataArray) return;

        dataArray.forEach(item => {

            // Ki 
            if (item.customType === "ki") {
                const div = document.createElement('div');
                div.className = 'notes-container'; 
                div.style.marginBottom = '8px';
                div.style.textAlign = 'center';
                div.style.border = '1px solid #dcdcdc';

                div.innerHTML = `
                    <span class="note-title" style="color:#8e44ad; margin-bottom:0;">KI POINTS (MAX)</span>
                    <div style="font-size: 1.4rem; font-weight: bold; color: #8e44ad;">${item.max}</div>
                `;
                container.appendChild(div);
                return; 
                }

            const details = document.createElement('details');
            const summary = document.createElement('summary');
            
            let badgeHTML = '';
            
            if (item.tag) {
                const tagClass = 'type-' + item.tag.toLowerCase();
                badgeHTML = `<span class="badge ${tagClass}">${item.tag}</span>`;
            }
            
            if (item.type) { 
                const colorClass = 'type-' + (item.type ? item.type.toLowerCase() : 'gear');
                badgeHTML = `<span class="badge ${colorClass}">${item.type}</span>`;
            }

            summary.innerHTML = `<span>${item.name}</span>${badgeHTML}`;
            
            const content = document.createElement('div');
            content.className = 'content';
            content.innerHTML = `<p>${item.desc}</p>`;
            
            details.appendChild(summary);
            details.appendChild(content);
            container.appendChild(details);
        });
    }

    function renderSpells() {
        const container = document.getElementById('spells-container');
        const spells = characterSheet.spells;
        container.innerHTML = ''; 

        if (!spells || spells.length === 0) return;

        spells.forEach(spell => {
            const details = document.createElement('details');
            const summary = document.createElement('summary');
            
            const levelText = spell.level === 0 ? "Cantrip" : `Lvl ${spell.level}`;
            const badgeClass = spell.level === 0 ? "type-cantrip" : "type-spell";

            summary.innerHTML = `
                <span>${spell.name}</span>
                <span class="badge ${badgeClass}">${levelText}</span>
            `;
            
            const content = document.createElement('div');
            content.className = 'content';
            
            content.innerHTML = `
                <div class="spell-meta">
                    <div class="meta-item"><span class="meta-label">Time</span><span class="meta-val">${spell.time}</span></div>
                    <div class="meta-item"><span class="meta-label">Range</span><span class="meta-val">${spell.range}</span></div>
                    <div class="meta-item"><span class="meta-label">Component</span><span class="meta-val">${spell.comp}</span></div>
                    <div class="meta-item"><span class="meta-label">Duration</span><span class="meta-val">${spell.dur}</span></div>
                </div>
                <p><i>School of ${spell.school}</i></p>
                <p>${spell.desc}</p>
            `;
            
            details.appendChild(summary);
            details.appendChild(content);
            container.appendChild(details);
        });
    }

    function openStatModal(key) {
        if(!characterSheet.stats || !characterSheet.stats[key]) return;
        const stat = characterSheet.stats[key];
        
        let html = `<p>${stat.desc}</p>`;
        if (stat.skills) {
            html += `<table class="skill-table">`;
            stat.skills.forEach(skill => {
                // Proficiency & Expertise
                let marker = '‚óã';
                let profClass = 'skill-marker';

                if (skill.e) { 
                    marker = '‚óé'; // Expertise icon
                    profClass += ' is-expert';
                } else if (skill.p) {
                    marker = '‚óè'; // Proficiency icon
                    profClass += ' is-proficient';
                }
                // -------------------------------------------

                const rowClass = skill.n === 'Save' ? 'skill-row save-row' : 'skill-row';
                const displayName = skill.n === 'Save' ? 'Saving Throw' : skill.n;
                html += `<tr class="${rowClass}"><td class="${profClass}">${marker}</td><td class="skill-cell skill-name">${displayName}</td><td class="skill-cell skill-val">${skill.v}</td></tr>`;
            });
            html += `</table>`;
        }
        document.getElementById('m-title').innerText = stat.title;
        document.getElementById('m-body').innerHTML = html;
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    initSheet();
</script>

</body>
</html>